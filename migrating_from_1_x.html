<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.9.2 from src/site/markdown/migrating_from_1_x.md at 2022-07-07
 | Rendered using Apache Maven Fluido Skin 1.9
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.9.2" />
    <title>socket.io-client &#x2013; Migrating from 1.x</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.9.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
    <script src="./js/apache-maven-fluido-1.9.min.js"></script>
  </head>
  <body class="topBarDisabled">
    <a href="https://github.com/socketio/socket.io-client-java">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png"
        alt="Fork me on GitHub">
    </a>
    <div class="container-fluid">
      <header>
        <div id="banner">
          <div class="pull-left"><div id="bannerLeft"><h2>Socket.IO Java client</h2>
</div>
</div>
          <div class="pull-right"></div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2022-07-07<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 2.0.2-SNAPSHOT</li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">Overview</li>
    <li><a href="installation.html" title="Installation"><span class="none"></span>Installation</a></li>
    <li><a href="initialization.html" title="Initialization"><span class="none"></span>Initialization</a></li>
    <li><a href="emitting_events.html" title="Emitting events"><span class="none"></span>Emitting events</a></li>
    <li><a href="listening_to_events.html" title="Listening to events"><span class="none"></span>Listening to events</a></li>
    <li><a href="socket_instance.html" title="The Socket instance"><span class="none"></span>The Socket instance</a></li>
    <li class="active"><a href="#"><span class="none"></span>Migrating from 1.x</a></li>
    <li><a href="logging.html" title="Logging"><span class="none"></span>Logging</a></li>
    <li><a href="faq.html" title="FAQ"><span class="none"></span>FAQ</a></li>
    <li><a href="android.html" title="Android"><span class="none"></span>Android</a></li>
   <li class="nav-header">Miscellaneous</li>
    <li><a href="changelog.html" title="Changelog"><span class="none"></span>Changelog</a></li>
    <li><a href="apidocs/index.html" title="Javadoc"><span class="none"></span>Javadoc</a></li>
   <li class="nav-header">Project Documentation</li>
    <li><a href="project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
            <hr />
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn"  class="span10" >
<h1>Migrating from 1.x</h1>
<p>The <code>2.0.0</code> release is the first release which is compatible with the Socket.IO v3 server. You can find more information about the v3 release here: <a class="externalLink" href="https://socket.io/blog/socket-io-3-release/">https://socket.io/blog/socket-io-3-release/</a></p>
<p>Here is the compatibility table:</p>
<table border="0" class="table table-striped">
<thead>

<tr class="a">
<th> Java client version </th>
<th> Socket.IO server </th></tr>
</thead><tbody>

<tr class="b">
<td> 0.9.x  </td>
<td> 1.x </td></tr>
<tr class="a">
<td> 1.x    </td>
<td> 2.x (or 3.1.x / 4.x with <a class="externalLink" href="https://socket.io/docs/v4/server-options/#alloweio3"><code>allowEIO3: true</code></a>) </td></tr>
<tr class="b">
<td> 2.x    </td>
<td> 3.x / 4.x </td></tr>
</tbody>
</table>
<p><b>Important note:</b> due to the backward incompatible changes to the Socket.IO protocol, a 2.x Java client will not be able to reach a 2.x server, and vice-versa</p>
<p>Since the Java client matches the Javascript client quite closely, most of the changes listed in the migration guide <a class="externalLink" href="https://socket.io/docs/v4/migrating-from-2-x-to-3-0">here</a> also apply to the Java client:</p>
<ul>

<li><a href="#A_middleware_error_will_now_emit_an_Error_object">A middleware error will now emit an Error object</a></li>
<li><a href="#The_Socket_query_option_is_renamed_to_auth">The Socket <code>query</code> option is renamed to <code>auth</code></a></li>
<li><a href="#The_Socket_instance_will_no_longer_forward_the_events_emitted_by_its_Manager">The Socket instance will no longer forward the events emitted by its Manager</a></li>
<li><a href="#No_more_.E2.80.9Cpong.E2.80.9D_event">No more &#x201c;pong&#x201d; event</a></li>
</ul>
<p>Additional changes which are specific to the Java client:</p>
<ul>

<li><a href="#An_extraHeaders_option_is_now_available">An <code>extraHeaders</code> option is now available</a></li>
</ul><section><section>
<h3><a name="A_middleware_error_will_now_emit_an_Error_object"></a>A middleware error will now emit an Error object</h3>
<p>The <code>ERROR</code> event is renamed to <code>CONNECT_ERROR</code> and the object emitted is now a <code>JSONObject</code>:</p>
<p>Before:</p>

<div class="source">
<div class="source"><pre class="prettyprint">socket.on(Socket.EVENT_ERROR, new Emitter.Listener() {
    @Override
    public void call(Object... args) {
        String error = (String) args[0];
        System.out.println(error); // not authorized
    }
});
</pre></div></div>

<p>After:</p>

<div class="source">
<div class="source"><pre class="prettyprint">socket.on(Socket.EVENT_CONNECT_ERROR, new Emitter.Listener() {
    @Override
    public void call(Object... args) {
        JSONObject error = (JSONObject) args[0];
        String message = error.getString(&quot;message&quot;);
        System.out.println(error); // not authorized

        JSONObject data = error.getJSONObject(&quot;data&quot;); // additional details (optional)
    }
});
</pre></div></div>
</section><section>
<h3><a name="The_Socket_query_option_is_renamed_to_auth"></a>The Socket <code>query</code> option is renamed to <code>auth</code></h3>
<p>In previous versions, the <code>query</code> option was used in two distinct places:</p>
<ul>

<li>in the query parameters of the HTTP requests (<code>GET /socket.io/?EIO=3&amp;abc=def</code>)</li>
<li>in the Socket.IO handshake</li>
</ul>
<p>Which could lead to unexpected behaviors.</p>
<p>New syntax:</p>

<div class="source">
<div class="source"><pre class="prettyprint">IO.Options options = new IO.Options();
options.query = singletonMap(&quot;abc&quot;, singletonList(&quot;def&quot;)); // included in the query parameters
options.auth = singletonMap(&quot;token&quot;, singletonList(&quot;1234&quot;)); // included in the Socket.IO handshake

Socket socket = IO.socket(&quot;https://example.com&quot;, options);
</pre></div></div>
</section><section>
<h3><a name="The_Socket_instance_will_no_longer_forward_the_events_emitted_by_its_Manager"></a>The Socket instance will no longer forward the events emitted by its Manager</h3>
<p>In previous versions, the Socket instance emitted the events related to the state of the underlying connection. This will not be the case anymore.</p>
<p>You still have access to those events on the Manager instance (the <code>io()</code> method of the socket) :</p>
<p>Before:</p>

<div class="source">
<div class="source"><pre class="prettyprint">socket.on(Socket.EVENT_RECONNECT_ATTEMPT, new Emitter.Listener() {
    @Override
    public void call(Object... objects) {
        // ...
    }
});
</pre></div></div>

<p>After:</p>

<div class="source">
<div class="source"><pre class="prettyprint">socket.io().on(Manager.EVENT_RECONNECT_ATTEMPT, new Emitter.Listener() {
    @Override
    public void call(Object... objects) {
        // ...
    }
});
</pre></div></div>

<p>Here is the updated list of events emitted by the Manager:</p>
<table border="0" class="table table-striped">
<thead>

<tr class="a">
<th> Name </th>
<th> Description </th>
<th> Previously (if different) </th></tr>
</thead><tbody>

<tr class="b">
<td> <code>Manager.EVENT_OPEN</code> </td>
<td> successful (re)connection </td>
<td> - </td></tr>
<tr class="a">
<td> <code>Manager.EVENT_ERROR</code> </td>
<td> (re)connection failure or error after a successful connection </td>
<td> <code>Manager.EVENT_CONNECT_ERROR</code> &amp; <code>Manager.EVENT_CONNECT_TIMEOUT</code> </td></tr>
<tr class="b">
<td> <code>Manager.EVENT_CLOSE</code> </td>
<td> disconnection </td>
<td> - </td></tr>
<tr class="a">
<td> <code>Manager.EVENT_RECONNECT_ATTEMPT</code> </td>
<td> reconnection attempt </td>
<td> <code>Manager.EVENT_RECONNECT_ATTEMPT</code> &amp; <code>Manager.EVENT_RECONNECTING</code> (duplicate) </td></tr>
<tr class="b">
<td> <code>Manager.EVENT_RECONNECT</code> </td>
<td> successful reconnection </td>
<td> - </td></tr>
<tr class="a">
<td> <code>Manager.EVENT_RECONNECT_ERROR</code> </td>
<td> reconnection failure </td>
<td> - </td></tr>
<tr class="b">
<td> <code>Manager.EVENT_RECONNECT_FAILED</code> </td>
<td> reconnection failure after all attempts </td>
<td> - </td></tr>
</tbody>
</table>
<p>Here is the updated list of events emitted by the Socket:</p>
<table border="0" class="table table-striped">
<thead>

<tr class="a">
<th> Name </th>
<th> Description </th>
<th> Previously (if different) </th></tr>
</thead><tbody>

<tr class="b">
<td> <code>Socket.EVENT_CONNECT</code> </td>
<td> successful connection to a Namespace </td>
<td> - </td></tr>
<tr class="a">
<td> <code>Socket.EVENT_CONNECT_ERROR</code> </td>
<td> connection failure </td>
<td> <code>Socket.EVENT_ERROR</code> </td></tr>
<tr class="b">
<td> <code>Socket.EVENT_DISCONNECT</code> </td>
<td> disconnection </td>
<td> - </td></tr>
</tbody>
</table>
<p>And finally, here&#x2019;s the updated list of reserved events that you cannot use in your application:</p>
<ul>

<li><code>connect</code> (used on the client-side)</li>
<li><code>connect_error</code> (used on the client-side)</li>
<li><code>disconnect</code> (used on both sides)</li>
<li><code>disconnecting</code> (used on the server-side)</li>
<li><code>newListener</code> and <code>removeListener</code> (EventEmitter <a class="externalLink" href="https://nodejs.org/api/events.html#events_event_newlistener">reserved events</a>)</li>
</ul>

<div class="source">
<div class="source"><pre class="prettyprint">socket.emit(&quot;connect_error&quot;); // will now throw an exception
</pre></div></div>
</section><section>
<h3><a name="No_more_.E2.80.9Cpong.E2.80.9D_event"></a>No more &#x201c;pong&#x201d; event</h3>
<p>In Socket.IO v2, you could listen to the <code>pong</code> event on the client-side, which included the duration of the last health check round-trip.</p>
<p>Due to the reversal of the heartbeat mechanism (more information <a class="externalLink" href="https://socket.io/blog/engine-io-4-release/#Heartbeat-mechanism-reversal">here</a>), this event has been removed.</p>
<p>Before:</p>

<div class="source">
<div class="source"><pre class="prettyprint">socket.once(Socket.EVENT_PONG, new Emitter.Listener() {
    @Override
    public void call(Object... args) {
        long latency = (long) args[0];
        // ...
    }
});
</pre></div></div>

<p>There is no similar API in the new release.</p></section><section>
<h3><a name="An_extraHeaders_option_is_now_available"></a>An <code>extraHeaders</code> option is now available</h3>
<p>This is a more straightforward way to provide headers that will be included in all HTTP requests.</p>

<div class="source">
<div class="source"><pre class="prettyprint">IO.Options options = new IO.Options();
options.extraHeaders = singletonMap(&quot;Authorization&quot;, singletonList(&quot;Bearer abcd&quot;));

Socket socket = IO.socket(&quot;https://example.com&quot;, options);
</pre></div></div>

<p>Or with the new builder syntax:</p>

<div class="source">
<div class="source"><pre class="prettyprint">IO.Options options = IO.Options.builder()
    .setExtraHeaders(singletonMap(&quot;Authorization&quot;, singletonList(&quot;Bearer abcd&quot;)))
    .build();

Socket socket = IO.socket(&quot;https://example.com&quot;, options);
</pre></div></div></section></section>
        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>&#169;      2022
</p>
        </div>
      </div>
    </footer>
  </body>
</html>
